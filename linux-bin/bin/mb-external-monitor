#!/usr/bin/env bash

# /etc/udev/rules.d/95-monitor-hotplug.rules
# KERNEL=="card0", SUBSYSTEM=="drm", ENV{DISPLAY}=":0", ENV{XAUTHORITY}="$HOME/.Xauthority", RUN+="/usr/bin/su isymch -c /home/isymch/bin/mb-external-monitor"

export DISPLAY=":0"
export XAUTHORITY="$HOME/.Xauthority"
export PULSE_RUNTIME_PATH="/run/user/$(id -u)/pulse"
export PULSE_SERVER="unix:/run/user/$(id -u)/pulse/native"
export DBUS_SESSION_BUS_ADDRESS="unix:path=/run/user/$(id -u)/bus"

int_mon="eDP1"
ext_mon="HDMI1"
#ext_mon="DP1"

int_audio="alsa_output.pci-0000_00_1b.0.analog-stereo"
ext_audio="alsa_output.pci-0000_00_03.0.hdmi-stereo"

INPUTS=($(pacmd list-sink-inputs | grep index | awk '{print $2}'))

function connect(){
    xrandr --output $ext_mon --auto --output $int_mon --off --verbose

    sleep 2

    # pactl set-default-sink $ext_audio
    # for i in ${INPUTS[*]}; do pacmd move-sink-input $i $ext_audio &> /dev/null; done
}

function disconnect(){
    xrandr --output $int_mon --auto --output $ext_mon --off --verbose

    sleep 2

    # pactl set-default-sink $int_audio
    # for i in ${INPUTS[*]}; do pacmd move-sink-input $i $int_audio &> /dev/null; done
}

xrandr | grep "^$ext_mon connected" &> /dev/null && connect || disconnect
